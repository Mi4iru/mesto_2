(()=>{"use strict";var e=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},t=function(e,t,n){var o=t.querySelector(n.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?o.classList.remove(n.inactiveButtonClass):o.classList.add(n.inactiveButtonClass)},n={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"1ef92f0f-4707-407d-8195-8d32e9d69658","Content-Type":"application/json"}};function o(e,t,o,r,c,a,u,i,s,l){var p=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),d=p.querySelector(".card__title"),_=p.querySelector(".card__image"),f=p.querySelector(".card__like-counter");d.textContent=e,_.src=t,_.alt=e,f.textContent=o.length;var v=p.querySelector(".card__like-button");c&&v.classList.add("card__like-button_is-active"),v.addEventListener("click",(function(){(function(e,t){var o;return o=t?"DELETE":"PUT",fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:o,headers:n.headers}).then((function(e){if(e.ok)return e.json();console.log("Ошибка: ".concat(e.status))}))})(a,v.classList.contains("card__like-button_is-active")).then((function(e){v.classList.toggle("card__like-button_is-active"),f.textContent=e.likes.length}))}));var y=p.querySelector(".card__delete-button");return r?y.addEventListener("click",(function(){(function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(a).then((function(e){y.closest(".card").remove()}))})):(y.disabled=!0,y.style.display="none"),_.addEventListener("click",(function(){i.src=t,i.alt=e,s.textContent=e,l(u)})),p}var r,c,a=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_image"),i=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_update-avatar"),l=u.querySelector(".popup__image"),p=u.querySelector(".popup__caption"),d=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),f=a.querySelector(".popup__close"),v=i.querySelector(".popup__close"),y=u.querySelector(".popup__close"),m=s.querySelector(".popup__close"),S=a.querySelector(".popup__form"),h=i.querySelector(".popup__form"),q=s.querySelector(".popup__form"),k=a.querySelector(".popup__input_type_name"),b=a.querySelector(".popup__input_type_description"),L=i.querySelector(".popup__input_type_card-name"),E=i.querySelector(".popup__input_type_url"),g=s.querySelector(".popup__input_type_url"),C=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),A=document.querySelector(".places__list"),P=function(e,n){var o=function(e){e.classList.remove("popup_is-opened"),n(e),document.removeEventListener("keydown",r)};function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");o(t)}}return{openModal:function(e){(function(e){var n=e.querySelector(M.formSelector);if(n){var o=Array.from(n.querySelectorAll(M.inputSelector));t(o,n,M)}})(e),e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)},closeModal:o}}(0,(function(t){var n=t.querySelector(M.formSelector);n&&Array.from(n.querySelectorAll(M.inputSelector)).forEach((function(t){e(n,t,M)}))})),U=P.openModal,T=P.closeModal,B=function(e){e.textContent="Сохранение..."},D=function(e){e.textContent="Сохранить"};fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){C.textContent=e.name,j.textContent=e.about,r=e._id,x.style.backgroundImage="url(".concat(e.avatar,")"),c=e,fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){for(var t=!1,n=0;n<e.likes.length;n++)if(e.likes[n].name==c.name&&e.likes[n].about==c.about){t=!0;break}var a=o(e.name,e.link,e.likes,e.owner._id==r,t,e._id,u,l,p,U);A.append(a)}))})).catch((function(e){console.log(e)}))})).catch((function(e){return console.log(e)})),x.addEventListener("click",(function(){g.value="",U(s)})),m.addEventListener("click",(function(){return T(s)})),q.addEventListener("submit",(function(e){e.preventDefault();var t,o=q.querySelector(".popup__button");B(o),(t=g.value,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.style.backgroundImage="url(".concat(e.avatar,")"),T(s)})).catch((function(e){return console.lof(e)})).finally((function(){D(o)}))})),d.addEventListener("click",(function(){k.value=C.textContent,b.value=j.textContent,U(a)})),f.addEventListener("click",(function(){return T(a)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,o,r=S.querySelector(".popup__button");B(r),(t=k.value,o=b.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){C.textContent=e.name,j.textContent=e.about,T(a)})).catch((function(e){return console.log(e)})).finally((function(){D(r)}))})),_.addEventListener("click",(function(){L.value="",E.value="",U(i)})),v.addEventListener("click",(function(){return T(i)})),h.addEventListener("submit",(function(e){e.preventDefault();var t,r,c=h.querySelector(".popup__button");B(c),(t=L.value,r=E.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=o(e.name,e.link,e.likes,!0,!1,e._id,u,l,U);A.prepend(t),T(i)})).catch((function(e){return console.log(e)})).finally((function(){D(c)}))})),y.addEventListener("click",(function(){return T(u)})),a.classList.add("popup_is-animated"),i.classList.add("popup_is-animated"),u.classList.add("popup_is-animated"),s.classList.add("popup_is_animated");var M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"};!function(n){Array.from(document.querySelectorAll(n.formSelector)).forEach((function(o){!function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector));t(r,n,o),r.forEach((function(c){c.addEventListener("input",(function(){!function(t,n,o){n.validity.valid?e(t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,n,n.validationMessage,o)}(n,c,o),t(r,n,o)}))}))}(o,n)}))}(M),a.addEventListener("click",(function(e){e.target===a&&T(a)})),i.addEventListener("click",(function(e){e.target===i&&T(i)})),s.addEventListener("click",(function(e){e.target===s&&T(s)})),u.addEventListener("click",(function(e){e.target===u&&T(u)}))})();